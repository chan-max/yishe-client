# 网络恢复功能快速启动指南

## 🚀 快速开始

### 1. 功能概述
为了解决"Protocol error: Connection closed"问题，我们新增了：
- **自动重连机制**: 检测到连接断开时自动恢复
- **心跳检测**: 定期检查连接状态
- **网络监控**: 监控网络状态变化
- **智能重试**: 避免过度重试的策略

### 2. 自动启用
新功能会在应用启动时自动启用，无需手动配置。

### 3. 监控日志
在控制台中可以看到详细的连接状态日志：
```
✅ 连接检查成功，页面数量: 1
💓 心跳检测正常，页面数量: 1
🔄 检测到协议错误，尝试重新连接...
🌐 网络已恢复
✅ 浏览器实例重新创建成功
```

## 📊 状态监控

### 连接状态
- ✅ **已连接**: 浏览器连接正常
- ❌ **未连接**: 连接已断开
- 🔄 **重连中**: 正在尝试重新连接
- ⚠️ **重试中**: 正在进行重试

### 网络状态
- 🌐 **在线**: 网络连接正常
- 📡 **离线**: 网络连接断开
- 🔍 **检查中**: 正在检查网络状态

## ⚙️ 配置调整

### 如果需要调整配置，可以修改以下参数：

#### 连接管理器配置
```typescript
// 在 src/main/connectionManager.ts 中修改
export const connectionManager = new ConnectionManager({
  maxRetries: 5,              // 最大重试次数
  retryDelay: 2000,           // 重试延迟 (毫秒)
  heartbeatInterval: 30000,   // 心跳检测间隔 (毫秒)
  maxReconnectAttempts: 10    // 最大重连次数
});
```

#### 网络监控配置
```typescript
// 在 src/main/networkMonitor.ts 中修改
export const networkMonitor = new NetworkMonitor({
  checkInterval: 30000,       // 网络检查间隔 (毫秒)
  maxFailures: 3,            // 最大连续失败次数
  recoveryDelay: 5000        // 恢复延迟 (毫秒)
});
```

## 🧪 测试功能

### 运行测试脚本
```bash
npm run test:network
```

### 手动测试
1. 启动应用
2. 观察控制台日志
3. 模拟网络断开（断开网络连接）
4. 观察自动恢复过程

## 🔧 故障排除

### 常见问题

#### 1. 频繁重连
**症状**: 应用频繁显示重连消息
**解决**: 
- 检查网络稳定性
- 增加重试延迟时间
- 调整最大重试次数

#### 2. 重连失败
**症状**: 重连持续失败
**解决**:
- 检查系统资源
- 验证网络连接
- 重启应用

#### 3. 性能问题
**症状**: 应用响应缓慢
**解决**:
- 调整心跳检测间隔
- 减少网络检查频率
- 检查系统资源使用

### 调试步骤

1. **查看日志**
   - 打开开发者工具
   - 查看控制台输出
   - 关注错误信息

2. **检查网络**
   - 测试网络连接
   - 检查防火墙设置
   - 验证代理配置

3. **重启服务**
   - 关闭应用
   - 清理临时文件
   - 重新启动

## 📈 性能优化

### 推荐配置

#### 网络较好的环境
```typescript
{
  retryDelay: 1000,
  maxRetries: 5,
  heartbeatInterval: 15000,
  checkInterval: 20000
}
```

#### 网络较差的环境
```typescript
{
  retryDelay: 5000,
  maxRetries: 3,
  heartbeatInterval: 60000,
  checkInterval: 45000
}
```

### 监控指标
- 连接成功率
- 重连频率
- 网络延迟
- 错误类型分布

## 📞 技术支持

如果遇到问题，请：
1. 查看控制台日志
2. 检查网络状态
3. 尝试重启应用
4. 联系技术支持

## 📝 更新日志

### v1.1.0 (2025-01-27)
- ✅ 新增网络监控服务
- ✅ 增强连接管理器功能
- ✅ 添加心跳检测机制
- ✅ 实现自动重连功能
- ✅ 优化错误处理逻辑

---

**注意**: 新功能会自动处理大部分连接问题，无需手动干预。如果问题持续存在，请检查网络环境或联系技术支持。 