# 衣设程序 - 系统托盘功能

## 功能概述

衣设程序现在支持系统托盘功能，让您可以在后台运行程序的同时保持对系统的访问。

## 托盘功能特性

### 1. 自动托盘显示
- 程序启动后自动在系统托盘显示图标
- 使用程序图标作为托盘图标
- 鼠标悬停显示程序名称

### 2. 托盘交互
- **单击托盘图标**: 切换主窗口显示/隐藏
- **双击托盘图标**: 显示并聚焦主窗口
- **右键托盘图标**: 打开托盘菜单

### 3. 托盘菜单功能
托盘菜单包含以下选项：

#### 主窗口控制
- **显示主窗口**: 显示并聚焦主窗口
- **隐藏主窗口**: 隐藏主窗口到托盘

#### 服务器状态检查
- **检查本地服务**: 检查本地服务器(端口1519)状态
- **检查远程服务**: 检查远程服务器连接状态

#### 程序控制
- **退出程序**: 完全退出应用程序

### 4. 窗口行为
- 关闭主窗口时程序不会退出，而是隐藏到托盘
- 只有通过托盘菜单的"退出程序"选项才会完全退出
- 支持最小化到托盘功能

### 5. 托盘通知
- 支持显示托盘气泡通知
- 可以自定义通知标题和内容
- 通知会显示程序图标

## 使用方法

### 基本操作
1. **启动程序**: 程序启动后会自动在系统托盘显示图标
2. **隐藏程序**: 点击窗口关闭按钮或使用托盘菜单隐藏
3. **显示程序**: 单击或双击托盘图标，或使用托盘菜单显示
4. **退出程序**: 右键托盘图标，选择"退出程序"

### 程序化控制
在渲染进程中可以通过以下API控制托盘功能：

```javascript
// 显示托盘通知
await window.api.showTrayNotification({
  title: '通知标题',
  body: '通知内容'
});

// 更新托盘提示文本
await window.api.updateTrayTooltip('新的提示文本');

// 隐藏主窗口到托盘
await window.api.hideMainWindow();

// 显示主窗口
await window.api.showMainWindow();
```

## 技术实现

### 主进程功能
- 使用Electron的`Tray`模块创建系统托盘
- 使用`Menu`模块创建托盘菜单
- 使用`nativeImage`处理托盘图标
- 通过IPC与渲染进程通信

### 渲染进程功能
- 通过preload脚本暴露托盘API
- 支持异步调用托盘功能
- 提供类型安全的API接口

### 跨平台支持
- **Windows**: 支持托盘图标、菜单和通知
- **macOS**: 支持托盘图标和菜单（通知使用系统通知中心）
- **Linux**: 支持托盘图标和菜单

## 配置选项

### 托盘图标
- 默认使用`resources/favicon.png`作为托盘图标
- 图标会自动调整为16x16像素大小
- 支持PNG格式图标

### 托盘菜单
- 菜单项支持快捷键（需要配置）
- 支持子菜单和分隔符
- 菜单项可以动态更新

### 窗口行为
- 可以通过修改`app.on('window-all-closed')`事件改变窗口关闭行为
- 支持自定义托盘显示逻辑

## 故障排除

### 托盘图标不显示
1. 检查图标文件是否存在
2. 确认图标文件格式正确
3. 检查系统托盘区域是否被隐藏

### 托盘菜单不响应
1. 检查IPC通信是否正常
2. 确认事件监听器已正确注册
3. 检查菜单项点击事件处理

### 窗口无法隐藏到托盘
1. 检查窗口关闭事件处理
2. 确认托盘实例已创建
3. 检查`app.isQuiting`标志设置

## 开发说明

### 添加新的托盘功能
1. 在主进程中添加IPC监听器
2. 在preload脚本中暴露API
3. 更新类型定义文件
4. 在渲染进程中使用新功能

### 自定义托盘菜单
修改`createTray()`函数中的菜单模板：

```javascript
const contextMenu = Menu.buildFromTemplate([
  {
    label: '自定义菜单项',
    click: () => {
      // 处理点击事件
    }
  }
]);
```

### 托盘图标更新
```javascript
// 更新托盘图标
const newIcon = nativeImage.createFromPath('path/to/new/icon.png');
tray.setImage(newIcon);
```

## 注意事项

1. **权限要求**: 某些系统可能需要特殊权限才能显示托盘图标
2. **系统兼容性**: 不同操作系统的托盘行为可能略有不同
3. **性能考虑**: 托盘功能对系统资源消耗很小
4. **用户体验**: 建议在首次使用时向用户说明托盘功能

## 更新日志

### v1.0.1
- 添加基础托盘功能
- 支持托盘菜单和通知
- 实现窗口隐藏到托盘
- 添加IPC通信接口 